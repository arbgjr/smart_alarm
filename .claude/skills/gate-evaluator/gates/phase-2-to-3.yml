gate_name: requirements_to_architecture
from_phase: 2
to_phase: 3
description: "Transicao de Requisitos para Arquitetura"

required_artifacts:
  - type: requirements_document
    description: "Documento de requisitos completo"
    agent: "requirements-analyst"
    validation:
      - has_acceptance_criteria: true
      - stakeholder_approved: true
    path_pattern: "docs/requirements*.md"

  - type: user_stories
    description: "User stories com criterios de aceite"
    agent: "requirements-analyst"
    validation:
      - count_minimum: 1
      - has_priority: true
      - has_acceptance_criteria: true
    path_pattern: "docs/stories/*.md"

  - type: nfr_document
    description: "Requisitos nao funcionais"
    agent: "requirements-analyst"
    validation:
      - has_performance_requirements: true
      - has_security_requirements: true
    path_pattern: "docs/nfr*.md"

  - type: ux_writing_spec
    description: "Especificacao de UX Writing (textos, estados, fluxos)"
    agent: "ux-writer"
    validation:
      - has_screen_definitions: true
      - has_error_messages: true
      - has_flow_documentation: true
    path_pattern: "docs/ux/*.md"
    optional_for_levels: [0, 1]

  - type: product_vision
    description: "Visao do produto e priorizacao"
    agent: "product-owner"
    validation:
      - has_mvp_definition: true
      - has_prioritization: true
    path_pattern: "docs/product/*.md"

  - type: spec_document
    description: "Spec Kit specification (se nivel >= 2)"
    validation:
      - valid_spec_format: true
      - analyzed: true
    path_pattern: "*.spec.md"
    optional_for_levels: [0, 1]

quality_checks:
  - name: requirements_completeness
    metric: completeness_score
    threshold: 0.8
    comparison: greater_or_equal

  - name: ambiguity_score
    metric: ambiguity_index
    threshold: 0.2
    comparison: less_or_equal

  - name: testability_score
    metric: testability_index
    threshold: 0.7
    comparison: greater_or_equal

  - name: user_story_count
    metric: story_count
    threshold: 1
    comparison: greater_or_equal

  - name: ux_screens_documented
    metric: screen_count
    threshold: 1
    comparison: greater_or_equal
    optional_for_levels: [0, 1]

human_approval:
  required: true
  roles:
    - product_owner
    - tech_lead
  timeout_hours: 24
  escalation_path:
    - engineering_manager
    - vp_engineering

gate_conditions:
  - all_artifacts_present: true
  - all_quality_checks_passed: true
  - required_approvals_obtained: true

stakeholder_review:
  description: "Arquivos que stakeholders devem revisar antes de prosseguir"
  notification: true
  reviewers:
    - role: product_owner
      files:
        - pattern: "docs/requirements*.md"
          priority: high
          description: "Documento de requisitos - validar completude"
        - pattern: "docs/product/*.md"
          priority: high
          description: "Visao do produto e MVP"
        - pattern: "docs/stories/*.md"
          priority: medium
          description: "User stories e prioridades"
    - role: tech_lead
      files:
        - pattern: "docs/nfr*.md"
          priority: high
          description: "Requisitos nao funcionais - validar viabilidade"
        - pattern: "*.spec.md"
          priority: medium
          description: "Especificacao tecnica"
    - role: ux_designer
      files:
        - pattern: "docs/ux/*.md"
          priority: high
          description: "Especificacao de UX Writing"
  message_template: |
    ## Revisao de Fase 2 (Requirements) Necessaria

    Os seguintes arquivos precisam ser revisados antes de avancar para Arquitetura:

    {{#each files}}
    - **{{this.description}}**: `{{this.pattern}}` (Prioridade: {{this.priority}})
    {{/each}}

    Por favor, revise e aprove para prosseguir.
